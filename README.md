# Проектная работа "Веб-ларек"
https://github.com/annabreamer/web-larek-frontend

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

Важные файлы:
- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```bash
npm install
npm run start
```

или

```bash
yarn
yarn start
```
## Сборка

```bash
npm run build
```

или

```bash
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка продукта в каталоге:

```typescript
export interface IProduct {
	id: string;
	description?: string;
	title: string;
	image: string;
	category: string;
	price: number | null;
}
```

Интерфейс для модели данных карточек:

```typescript
export interface IAppState {
	catalog: IProduct[];
	preview: string | null;
}
```

Возможные варианты оплаты, которые указываются при оформлении заказа:

```typescript
export enum PaymentMethod {
	card = 'card',
	cash = 'cash',
}
```

Данные формы заказа:

```typescript
export interface IOrderForm {
	payment: PaymentMethod;
	address: string;
}
```

Контактные данные покупателя, необходимые для заказа:

```typescript
export interface IContactInfoForm {
	email: string;
	phone: string;
}
```

Полная информация о заказе:

```typescript
export interface IOrder extends IOrderForm, IContactInfoForm {
	items: IProduct[];
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления отвечает за отображение данных на странице, 
- слой данных отвечает за хранение и изменение данных,
- презентер отвечает за связь представления и данных.

### Базовый код

#### Класс `Api`
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
- `get` — выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает `Promise` с объектом, которым ответил сервер,
- `post` — принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом, описаны интерфейсом `IEvents`:
- `on` — подписка на событие,
- `emit` — инициализация события,
- `trigger` — возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Базовый класс `Model`
Класс является дженериком, представляет собой абстрактную базовую модель для всех классов в слое данных. В конструктор принимает частичный объект данных и экземпляр класса для работы с событиями, позволяющий инициировать события при изменении модели. Содержит метод `emitChanges`, отвечающий за уведомление о любых изменениях данных модели.

#### Класс `AppState`
Класс отвечает за хранение и логику работы с данными карточек продукта.
В полях класса хранятся следующие данные:
- `catalog: IProduct[]` — каталог продуктов, который представляет из себя массив объектов продуктов,
- `preview: string | null` — идентификатор продукта, для которого открыт попап,
- `order: IOrder | null` — заказ покупателя,
- `formErrors: FormErrors` — объект, содержащий ошибки формы заказа.

Также класс предоставляет набор методов для взаимодействия с этими данными:
- `getProduct(productId: string): IProduct | undefined` — возвращает продукт по его идентификатору,
- `setCatalog(items: IProduct[])` — заполняет каталог продуктами,
- `getItemsCount(): number` — показывает количество продуктов в заказе, если их нет, то возвращает 0,
- `getItemsTotal(): number` — показывает сумму заказа, если его нет, то возвращает 0,
- `addToOrder(product: IProduct): void` — добавляет продукт в заказ,
- `removeFromOrder(productId: string): void` — удаляет продукт из заказа и, если корзина пустая, то вызывает метод `clearOrder()`,
- `clearOrder(): void` — обнуление текущего заказа,
- `setPreview(product: IProduct): void` — указывает продукт, для которого надо открыть попап,
- `setOrderField(field: keyof IContactInfoForm | 'address', value: string)` — указывает значение поля для его валидации,
- `setPaymentMethod(value: PaymentMethod): void` — определяет способ оплаты заказа,
- `validateOrder(): void` — проверяет поля заказа на наличие ошибок и показывает сообщения об ошибках, если они имеются.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый класс `Component`
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод `render` для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод `render`, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс `Modal`
Реализует модальное окно. Также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели для закрытия модального окна по кнопке закрытия или клику в оверлей.
- `constructor(container: HTMLElement, events: IEvents)` — принимает DOM-элемент контейнера модального окна и экземпляр класса `EventEmitter` для инициации событий.

Поля класса:
- `_content: HTMLElement` — контейнер модального окна,
- `_closeButton: HTMLButtonElement` — кнопка закрытия модального окна.

#### Класс `Basket`
Отвечает за отображение корзины товаров, показывает список товаров, общую сумму и кнопку оформления заказа. Реализует взаимодействие с корзиной с помощью событий, отправляемых через брокер `EventEmitter`.
- `constructor(container: HTMLElement, events: EventEmitter)` — принимает DOM-элемент контейнера корзины и экземпляр класса `EventEmitter` для инициации событий.

Поля класса:
- `_list: HTMLElement` — элемент для отображения списка товаров в корзине,
- `_total: HTMLElement` — элемент для отображения общей стоимости товаров в корзине,
- `_button: HTMLElement` — кнопка оформления заказа.

Методы класса:
- `set items(items: HTMLElement[])` — обновляет список продуктов в корзине,
- `set total(total: number)` — показывает общую стоимость заказа, деактивирует кнопку оформления при нулевой стоимости.

#### Класс `Form`
Класс представляет собой обобщённую модель формы, обеспечивающую обработку ввода данных и отправку формы с помощью событий.
- `constructor(container: HTMLFormElement, events: IEvents)` — принимает элемент формы и экземпляр класса `EventEmitter` для инициации событий.

Поля класса:
- `_submit: HTMLButtonElement` — кнопка отправки формы,
- `_errors: HTMLElement` —  элемент для отображения ошибок формы.

Методы класса:
- `onInputChange(field: keyof T, value: string)` — вызывается при изменении полей формы,
- `set valid(value: boolean)` — отключает кнопку отправки формы в случае невалидности данных,
- `set errors(value: string)` — показывает сообщение об ошибке, если валидация не пройдена.

#### Класс `Success`
Класс отображает информацию об успешном завершении заказа и с помощью метода `set total` показывает сумму списания.
- `(container: HTMLElement, actions: ISuccessActions)` — принимает элемент контейнера и объект `ISuccessActions`, содержащий обработчик события для закрытия уведомления.

Поля класса:
- `_close: HTMLElement` — кнопка закрытия попапа,
- `_description: HTMLElement` —  элемент для отображения суммы списания.

#### Класс `Order`
Отвечает за управление формой заказа, а именно выбор способа оплаты и указание адреса доставки. В конструктор класса передается элемент формы и объект `IEvents` для управления событиями формы.

Методы:
- `set payment(value: PaymentMethod)` — выбирает способ оплаты,
- `set address(value: string)` — устанавливает значение адреса доставки.

#### Класс `Contacts`
Управляет контактной информацией покупателя в форме, с помощью сеттеров `phone` задает телефон и `email` электронный адрес.

#### Класс `Page`
Отвечает за интерфейс страницы, управляет счетчиком корзины, отбражением каталога, оберткой страницы.
Поля класса:
- `_counter: HTMLElement` — элемент для отображения количества товаров в корзине,
- `_catalog: HTMLElement` — каталог продуктов на странице,
- `_wrapper: HTMLElement` — обертка страницы, используется для блокировки скроллинга страницы,
- `_basket: HTMLElement` — элемент корзины.

Методы класса:
- `set counter(value: number)` — отображает количество продуктов в корзине,
- `set catalog(items: HTMLElement[])` — обновляет содержимоме каталога продуктов,
- `set locked(value: boolean)` — блокирует или разблокирует страницу, добавляя или удаляя соответствующий класс у обертки страницы.

### Слой коммуникации

#### Класс `ProductApi`
Принимает в конструктор URL CDN и API и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий, и обработчиков этих событий, описанных в `index.ts`.
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Список всех событий, которые могут генерироваться в системе
#### События изменения данных (генерируются моделями данных)
- `items:changed` — изменение продуктов в каталоге,
- `basket:changed` — изменение содержимого корзины,
- `order:updated` — обновление заказа.

#### События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)
- `card:select` — выбор карточки продукта,
- `basket:open` — открытие корзины,
- `order:open` — открытие формы заказа,
- `order:submit` — отправка формы заказа, переключение на форму контактной информации,
- `contacts:submit` — отправка формы контактной информации,
- `modal:open` — открытие модального окна,
- `modal:close` — закрытие модального окна,
- `order.address:change` — изменение адреса в форме заказа,
- `order.payment:change` — изменение метода оплаты в форме заказа,
- `contacts.phone:change` — изменение телефона в форме контактной информации,
- `contacts.email:change` — изменение электронного адреса в форме контактной информации,
- `formErrors:change` — изменение валидации формы,
- `preview:changed` — открытие превью для просмотра товара.
